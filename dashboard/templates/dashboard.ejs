<head>
    <link href="/css/base.css" rel="stylesheet" type="text/css">
    <link href="/css/dashboard.css" rel="stylesheet" type="text/css">
</head>

<body>
    <%- include("partials/header", { bot, user, path, title: "伺服器列表" }) %>

    <h1>選擇伺服器</h1>
    <% user.guilds.forEach(guild => {
    const permsOnGuild = new perms(guild.permissions);
    if(!permsOnGuild.has("MANAGE_GUILD")) return;
    %>

    <div class="guild_container <%= bot.guilds.cache.get(guild.id) ?"" :"invite" %>">
        <% if (guild.icon) { %>
            <img class="guild_icon"src="https://cdn.discordapp.com/icons/<%= guild.id %>/<%= guild.icon %>.png?size=64" alt="" draggable="false">
        <% } else { %>
            <div class="guild_icon"><%= guild.name.split(/\s/).reduce((response,word)=> response+=word.slice(0,1),'') %></div>
        <% } %>

        <p class="guild_name"><%= guild.name %></p>
        <div class="guild_action">
        <% if (bot.guilds.cache.get(guild.id)) { %>
        <a class="setting" href="/dashboard/<%= guild.id %>">設定</a>
        <% } else { %>
        <a class="invite"
            href="<%= `https://discordapp.com/oauth2/authorize?client_id=${bot.user.id}&permissions=2482367702&scope=bot%20applications.commands&guild_id=${guild.id}&response_type=code&redirect_uri=${encodeURIComponent(`${bot.config.domain}${bot.config.port == 80 ? "" : `:${bot.config.port}`}/callback`)}` %>">
            邀請
        </a>
        <% } %>
        </div>
    </div>
    <% }); %>
    <%- include("partials/footer") %>